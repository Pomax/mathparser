<!doctype html>
<html>
  <head>
    <meta charset="utf8">
    <title>A JavaScript math function library</title>
    <style>
      div[style] { width: 49%; border: }
      code { background: #EEE; font-size: 90%; }
      dt { font-weight: bold; }
      input[type=range] { width: 60%; vertical-align:-0.7em; }
      input[type=text] { width: 3em; }
      figure { padding:5px; margin:0; border: 1px solid #CCC; width:400px; }
      figure div { text-align: center; }
      #prettyFormula { text-align: center; }
      .MathJax_Display { width: 100%!important; tex-align: center!important; }
    </style>
  </head>
  <body>

    <h2>A JavaScript plotting library</h2>

    <div style="float:left;">
      <input type="text" id="function" value="sin(x) - tan(x) + cos(x^2.4)" style="width:400px">
      <button onclick="plot()">plot</button>
      <figure>
        <div id="plots"></div>
        <p id="prettyFormula"></p>
        <div><input type="range" class="start" min="0" max="1000" step="1" value="0" onchange="plot()">
          (start <span id='startval'></span>)
        </div>
        <div><input type="range" class="end" min="0" max="1000" step="1" value="1000" onchange="plot()">
          (end <span id='endval'></span>)
        </div>
        <div><input type="range" class="step" min="1" max="10000" step="1" value="3000" onchange="plot()">
          (step <span id='stepval'></span>)
        </div>
      </figure>

      <div>
        <h3>viewbox values:</h3>
        minx: <input type="text" id="v_minx" value="0" onchange="plot()">
        maxx: <input type="text" id="v_maxx" value="10" onchange="plot()">
        miny: <input type="text" id="v_miny" value="-100" onchange="plot()">
        maxy: <input type="text" id="v_maxy" value="100" onchange="plot()">
      </div>

    </div>

    <div style="float:right;">
      <h3>A bit of API</h3>
      <p>This library gives you a <code>MathFunction</code> object, which is created
      with a function string as constructor argument, such as <code>new MathFuction("sin(x)
      - tan(x) + cos(x^2.4)")</code>. You can also set up a parametric function (in two dimensions)
      by comma-separating the functions, such as <code>new MathFunction("cos(x), sin(x)")</code>.
      If your function was balanced (i.e. all the opening parentheses have matching closing
      parentheses) you can use the following API (if unbalanced, the constructor throws an
      error for you to catch):</p>

      <dl>
        <dt>render(container)</dt>
        <dd>shows the function as LaTeX in [container]. If MathJax is loaded, typesets it prettily.</dd>

        <dt>plot(container, options, viewbox)</dt>
        <dd>Plots the function, based on the given options: <code>{ variable: 'var that changes', start: number,
        end: number, step: number, clamps: [ {label:'var that is clamped', value:number}, ... ]}</code>. If a
        viewbox is given, of the form <code>{minx:num, maxx:num, miny:num, maxy:num}</code>, the plot will
        be constrained to those values.</dd>
      </dl>

      <h3>Supported operations</h3>
      <p>The MathFunction object understands the following operators and functions:</p>

      <dl>
        <dt>numbers and constants</dt>
        <dd>integer and floating point numbers, supported constants: e, Ï€</dd>

        <dt>basic operators and grouping</dt>
        <dd>...+..., ...-..., ...*..., .../..., ...^..., ...!, -..., (...)</dd>

        <dt>built in functions, of the form fn(...)</dt>
        <dd>sin, cos, tan, asin, acos, atan, sinh, cosh, tanh, ln, log, sqrt, abs</dd>

        <dt>built in aggregators, of the form fn(start, end, [function]), using "n" as control variable</dt>
        <dd>sum, prod</dd>

        <dt>special aggregators</dt>
        <dd>area(start, end, steps, varname, [function])</dd>
      </dl>
    </div>

    <script src="head.js"></script>
    <script>
      /**
       * plotting function based on on-page parameters
       */
      function plot() {
        var fn = document.querySelector("#function").value,
            p = document.getElementById('prettyFormula'),
            plotDiv = document.getElementById("plots"),
            mathFunction = new MathFunction(fn),
            start = (document.querySelector('input[type=range].start').value | 0)/100,
            end   = (document.querySelector('input[type=range].end').value | 0)/100,
            step  = (end-start)/(document.querySelector('input[type=range].step').value | 0);

        end = (end>start ? end : start + 0.1);
        step = (step>0 ? step : 0.001);
        document.querySelector('#startval').innerHTML = Math.round(start*1000)/1000;
        document.querySelector('#endval').innerHTML = Math.round(end*1000)/1000;
        document.querySelector('#stepval').innerHTML = Math.round(step*100000)/100000;

        var options = {
              width: 400,
              height: 400,
              variable: 'x',
              start: start,
              end: end,
              step: step,
              clamps: [
                {label:'a',value:1},
                {label:'b',value:1},
                {label:'y',value:Math.PI}
              ]
            };

        // show formula on the page
        mathFunction.render(p);

        // plot formula
        var viewbox = {
          minx: parseFloat(document.querySelector("#v_minx").value),
          maxx: parseFloat(document.querySelector("#v_maxx").value),
          miny: parseFloat(document.querySelector("#v_miny").value),
          maxy: parseFloat(document.querySelector("#v_maxy").value)
        };
        if(viewbox.minx < start) viewbox.minx = start;
        if(viewbox.maxx > end) viewbox.maxx = end;

        mathFunction.plot(plotDiv, options, viewbox);
      }

      /**
       * load the MathFunction object
       */
      head.js('FunctionTree.js',
              'Tape.js',
              'ArithmeticFragment.js',
              'SimpleNodes.js',
              'OperatorNodes.js',
              'FunctionNodes.js',
              'AggregatorNodes.js',
              'MathFunction.js',
              'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML',
              function() { plot(); });
    </script>
  </body>
</html>
